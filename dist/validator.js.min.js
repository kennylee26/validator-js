/**
 *
 * validator-js - 提供前端的验证工具
 *
 * @version v0.0.1
 * @license BSD-3-Clause
 * @author Kennylee
 *
 */
!function(t,e){"use strict";function r(t){this.options=a.clone(this.constructor.defaults),this.option(t)}var n=t,i=e,a={isObject:function(t){return t&&"object"==typeof t&&!this.isArray(t)},isElement:function(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},getValue:function(t){if(this.isElement(t)){var e;return"input"===t.nodeName.toLowerCase()?e=t.value:"select"===t.nodeName.toLowerCase()&&(e=t.options[t.selectedIndex].value),e}},isArray:function(t){return Array.isArray(t)},isNotEmptyArray:function(t){return this.isArray(t)&&t.length>0},getInputs:function(t){var e=this.isElement(t)?t:i;return[].concat(Array.prototype.slice.call(e.getElementsByTagName("input"),0),Array.prototype.slice.call(e.getElementsByTagName("select"),0))},getElementsByName:function(t,e){if(i.getElementsByName&&this.isElement(e))return i.getElementsByName(t);var r=[],n=this.getInputs(e);if(this.isNotEmptyArray(n))for(var a=0,s=n.length;a!==s;a++){var o=n[a];o.getAttribute("name")===t&&r.push(o)}return r},getSingleElementByName:function(t,e){var r=this.getElementsByName(t,e);if(r&&r.length>0)return r[0]},clone:function(t){return this.mixin({},t)},mixin:function(t,e){var r=t||{};for(var n in e)e.hasOwnProperty(n)&&(this.isObject(e[n])?r[n]=this.mixin(r[n],e[n]):this.isArray(e[n])?r[n]=e[n].concat():r[n]=e[n]);return r},isString:function(t){return"string"==typeof t||t instanceof String},trim:function(t){return this.isString(t)?t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):""},strToJSON:function(t){var e={};if(t){t=a.trim(t),"{"!==t.substring(0,1)&&(t="{"+t+"}");try{e=new Function("return "+t)()}catch(e){alert("strToJSON failed! \n "+t)}}return e},stringFormat:function(t,e){if(this.isNotEmptyArray(e))for(var r=0;r!==e.length;r++){var n=new RegExp("\\{"+r+"\\}","gm");t=t.replace(n,e[r])}return t},getMatches:function(t,e,r){for(var n,i=void 0===r?1:r,a=[];n=e.exec(t);)a.push(n[i]);return a}},s=function(t){return!/^(([A-Z]*|[a-z]*|\d*|[-_\~!@#\$%\^&\*\.\(\)\[\]\{\}<>\?\\\/\'\"]*)|.{0,5})$|\s/.test(t)},o=function(t,e){t=t||"yyyy-MM-dd";var r=function(t,e,r,n,i){n=n||60,i=i||2;var a=r;return(void 0!==t&&""!==t||!isNaN(t))&&(a=1*t),void 0===e||""===e||isNaN(e)||(a=1*e),a===t&&t.length!==i||a>n?-1e4:a},n=this,i={},a=new Date,s=t.split(/[^a-z]+/gi),o=n.split(/\D+/g),u=t.split(/[a-z]+/gi),c=n.split(/\d+/g),l=s.length,y=u.length;if(l!==o.length||y!==c.length)return!1;for(var m=0;m<y;m++)if(u[m]!==c[m])return!1;for(m=0;m<l;m++)i[s[m]]=o[m];if(i.yyyy=r(i.yyyy,i.yy,a.getFullYear(),9999,4),i.MM=r(i.MM,i.M,a.getMonth()+1,12),i.dd=r(i.dd,i.d,a.getDate(),31),i.hh=r(i.hh,i.h,a.getHours(),24),i.mm=r(i.mm,i.m,a.getMinutes()),i.ss=r(i.ss,i.s,a.getSeconds()),i.ms=r(i.ms,i.ms,a.getMilliseconds(),999,3),i.yyyy+i.MM+i.dd+i.hh+i.mm+i.ss+i.ms<0)return!1;i.yyyy<100&&(i.yyyy+=i.yyyy>30?1900:2e3),a=new Date(i.yyyy,i.MM-1,i.dd,i.hh,i.mm,i.ss,i.ms);var g=a.getFullYear()===i.yyyy&&a.getMonth()+1===i.MM&&a.getDate()===i.dd&&a.getHours()===i.hh&&a.getMinutes()===i.mm&&a.getSeconds()===i.ss&&a.getMilliseconds()===i.ms;return g&&e?a:g},u=function(t){var e=t.getAttribute("data-validator-options");if(e)return a.strToJSON(e)},c=function(t){var e=/([^\[]+)(\[(.+)])?/g.exec(t);if(e){var r=[],n=e[3],i=[];if(n&&(i=n.split(",")),i.length>0)for(var a=0,s=i.length;a!==s;a++){var o=$.trim(i[a]),u=/"([^"]+)"/g.exec(t);u&&(o=u[1]),r.push(o)}return{name:e[1],params:r}}},l=function(t){if(18===t.length&&18!==t.length)return!1;var e,r=t.toLowerCase(),n=0,i="10x98765432",a=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],s=r.match(/^(\d{2})\d{4}(((\d{2})(\d{2})(\d{2})(\d{3}))|((\d{4})(\d{2})(\d{2})(\d{3}[x\d])))$/);if(null===s||"11,12,13,14,15,21,22,23,31,32,33,34,35,36,37,41,42,43,44,45,46,50,51,52,53,54,61,62,63,64,65,71,81,82,91".indexOf(s[1])<0)return!1;if(9===s[2].length?(r=r.substr(0,6)+"19"+r.substr(6),e=["19"+s[4],s[5],s[6]].join("-")):e=[s[9],s[10],s[11]].join("-"),!o.call(e,"yyyy-MM-dd"))return!1;for(var u=0;u<17;u++)n+=r.charAt(u)*a[u];return 9===s[2].length||r.charAt(17)===i.charAt(n%11)};r.defaults={message:{required:"该输入项为必输项!",zip:"邮政编码不存在!",loginName:"登录名称只允许英文字母、数字及下划线!",mobile:"手机号码格式不正确!",safePwd:"密码由字母和数字组成，至少6位!",length:"无效的输入项，请输入{0}-{1}的字符!",equalTo:"两次输入的密码不一致!",number:"请输入数字!",idCard:"请输入正确的身份证号码!",email:"无效的邮箱地址!"},validType:{required:{check:function(t){var e=a.trim(t);return!!(e&&e.length>0)}},zip:{check:function(t){return/^[1-9]\d{5}$/.test(t)}},mobile:{check:function(t){return/^((13[0-9])|(15[^4])|(18[0,2,3,5-9])|(17[0-8])|(147))\d{8}$/.test(t)}},loginName:{check:function(t){return/^[a-zA-Z0-9_]+$/.test(t)}},safePwd:{check:function(t,e){return s(t)}},length:{check:function(t,e){if(!e||isNaN(e[0])||isNaN(e[1]))return console.log("invalid params for length..."),!1;var r=$.trim(t);return r.length>=e[0]&&r.length<=e[1]}},equalTo:{check:function(t,e){if(!a.isNotEmptyArray(e))return console.log("param must be array..."),!1;var r,n=a.getElementsByName(e[0]);if(a.isNotEmptyArray(n)){var i=n[0];r=a.getValue(i)}return t===r}},number:{check:function(t){return/^\d+$/.test(t)}},idCard:{check:function(t){return l(t)}},email:{check:function(t){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(t)}}}},a.mixin(r.prototype,{option:function(t){a.mixin(this.options,t)},getValidType:function(){return this.options.validType},checkForm:function(t){if(a.isElement(t)&&"form"===t.nodeName.toLowerCase()){var e=a.getInputs(t),r=[];if(a.isNotEmptyArray(e))for(var n=0,i=e.length;n!==i;n++){var s=e[n],o=s.getAttribute("name"),l=u(s),y=!(!l||!l.required||!0!==l.required&&"true"!==a.trim(l.required).toLowerCase()),m=void 0;if(y){var g=this.check(o,"required",t);g&&!g.isValid&&(m=g)}if(void 0===m&&l&&l.validType&&a.isNotEmptyArray(l.validType))for(var f=0,h=l.validType.length;f!==h;f++){var d=l.validType[f],p=c(d),v=this.check(o,p.name,t,p.params);if(v&&!v.isValid){v.invalidMessage=a.stringFormat(v.invalidMessage,p.params),m=v;break}}void 0!==m&&r.push({target:s,error:m})}return r}alert("only support form element.")},check:function(t,e,r,n){var i=this.getValidType()[e];if(!i)return void alert("invalid type name:  "+e+"\n input name: "+t);var s=a.getValue(a.getSingleElementByName(t,r)),o=i.check(s,n),u=this;return{isValid:o,invalidMessage:o?"":u.options.message[e]}}}),n.Validator=r}(window,document);